!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){var t={exports:{}};return e(t,t.exports),t.exports}var r=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=void 0;return new Proxy(r,{construct:function(e,r){var o=a.slice(0,a.length-1),i=a[a.length-1];return t([].concat(n(o),[{type:"construct",key:i.key,args:r}]))},get:function(r,i){if("then"===i){return e(t,(function(e,r){return o||(o=t(a)),o.then(e,r)}),[].concat(n(a),[{type:"get",key:i}]))}return e(t,(function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return t([].concat(n(a),[{type:"apply",key:i,args:r}]))}),[].concat(n(a),[{type:"get",key:i}]))},set:function(e,r,o){return t([].concat(n(a),[{type:"set",key:r,value:o}]))}})};function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var a=Object.defineProperty({default:r},"__esModule",{value:!0}),o=function(){return Array.from({length:8},(function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})).join("")};var i=Object.defineProperty({default:o},"__esModule",{value:!0}),s=t((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ACTION_OPERATION="__$$__WEB_WORKER_PROXY__ACTION_OPERATION",t.ACTION_DISPOSE="__$$__WEB_WORKER_PROXY__ACTION_DISPOSE",t.RESULT_SUCCESS="__$$__WEB_WORKER_PROXY__RESULT_SUCCESS",t.RESULT_ERROR="__$$__WEB_WORKER_PROXY__RESULT_ERROR",t.RESULT_CALLBACK="__$$__WEB_WORKER_PROXY__RESULT_CALLBACK",t.TYPE_ERROR="__$$__WEB_WORKER_PROXY__TYPE_ERROR",t.TYPE_FUNCTION="__$$__WEB_WORKER_PROXY__TYPE_FUNCTION",t.TYPE_PERSISTED_FUNCTION="__$$__WEB_WORKER_PROXY__TYPE_PERSISTED_FUNCTION",t.MESSAGE_DISPOSED_ERROR="The function has been disposed and is no longer available."})),u=function(e){if(e instanceof Error)return{type:s.TYPE_ERROR,name:e.constructor.name,message:e.message,stack:e.stack};return e},l=function(t){if(null!=t&&t.type===s.TYPE_ERROR){var r="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==e?e:null,n=t.name,a=t.message,o=t.stack,i=new(r&&r[n]?r[n]:Error)(a);return i.stack=o,i}return t};var f=Object.defineProperty({serialize:u,deserialize:l},"__esModule",{value:!0}),d=function(e){return(0,_.default)((function(t){return r=s.ACTION_OPERATION,n=t,new Promise((function(t,a){var o=(0,c.default)(),i=new Map,u=!1;if(r===s.ACTION_OPERATION){var l=n[n.length-1];"apply"===l.type?l.args=l.args.map((function(t){if("function"==typeof t){var r=(0,c.default)();return i.set(r,t),{type:s.TYPE_FUNCTION,ref:r}}if(null!=t&&t.type===s.TYPE_PERSISTED_FUNCTION){var n=(0,c.default)();return i.set(n,t),t.on("dispose",(function(){i.delete(n),_(),e.postMessage({type:s.ACTION_DISPOSE,ref:n})})),{type:s.TYPE_FUNCTION,ref:n,persisted:!0}}return(0,f.serialize)(t)})):"set"===l.type&&(l.value=(0,f.serialize)(l.value))}var d=function(e){switch(e.data.type){case s.RESULT_SUCCESS:e.data.id===o&&(t((0,f.deserialize)(e.data.result)),u=!0,_());break;case s.RESULT_ERROR:e.data.id===o&&(a((0,f.deserialize)(e.data.error)),u=!0,_());break;case s.RESULT_CALLBACK:if(e.data.id===o){var r=e.data.func,n=r.ref,l=r.args,d=i.get(n);d&&(d.apply(null,l.map(f.deserialize)),d.type!==s.TYPE_PERSISTED_FUNCTION&&i.delete(n)),_()}}},_=function(){0===i.size&&u&&e.removeEventListener("message",d)};e.addEventListener("message",d),e.postMessage({type:r,id:o,data:n})}));var r,n}))},_=p(a),c=p(i);function p(e){return e&&e.__esModule?e:{default:e}}var E=Object.defineProperty({default:d},"__esModule",{value:!0}),y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self;if(O.has(t))throw new Error("The specified target already has a proxy. To create a new proxy, call `dispose` first to dispose the previous proxy.");O.set(t,!0);var r=[],n=function(n){switch(n.data.type){case s.ACTION_OPERATION:!function(){var a=n.data,o=a.id,i=a.data;try{var u=e,l=!0,d=!1,_=void 0;try{for(var c,p=i[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){var E=c.value;if("get"===E.type)u=u[E.key];else if("set"===E.type)u=Reflect.set(u,E.key,(0,f.deserialize)(E.value));else{if("apply"!==E.type)throw new Error('Unsupported operation "'+E.type+'"');var y=u[E.key];if("function"!=typeof y)throw new TypeError(E.key+" is not a function");u=y.apply(void 0,R(E.args.map((function(e){return null!=e&&e.type===s.TYPE_FUNCTION?(n=!1,e.persisted&&r.push(e.ref),function(){for(var a=arguments.length,i=Array(a),u=0;u<a;u++)i[u]=arguments[u];if(n&&!r.includes(e.ref))throw new Error(s.MESSAGE_DISPOSED_ERROR);n=!0,t.postMessage({type:s.RESULT_CALLBACK,id:o,func:{args:i.map(f.serialize),ref:e.ref}})}):(0,f.deserialize)(e);var n}))))}}}catch(e){d=!0,_=e}finally{try{!l&&p.return&&p.return()}finally{if(d)throw _}}u&&"function"==typeof u.then?Promise.resolve(u).then((function(e){return t.postMessage({type:s.RESULT_SUCCESS,id:o,result:(0,f.serialize)(e)})}),(function(e){return t.postMessage({type:s.RESULT_ERROR,id:o,error:(0,f.serialize)(e)})})):t.postMessage({type:s.RESULT_SUCCESS,id:o,result:(0,f.serialize)(u)})}catch(e){t.postMessage({type:s.RESULT_ERROR,id:o,error:(0,f.serialize)(e)})}}();break;case s.ACTION_DISPOSE:var a=r.indexOf(n.data.ref);a>-1&&r.splice(a,1)}};return t.addEventListener("message",n),{dispose:function(){t.removeEventListener("message",n),O.delete(t)}}};function R(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var O=new WeakMap;var S=Object.defineProperty({default:y},"__esModule",{value:!0}),v=function(e){var t=[],r=!1;return{type:s.TYPE_PERSISTED_FUNCTION,apply:function(t,n){if(r)throw new Error(s.MESSAGE_DISPOSED_ERROR);return e.apply(t,n)},dispose:function(){t.forEach((function(e){return e()})),r=!0},on:function(e,r){"dispose"===e&&t.push(r)},get disposed(){return r}}};var T=Object.defineProperty({default:v},"__esModule",{value:!0}),g=t((function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"create",{enumerable:!0,get:function(){return r(E).default}}),Object.defineProperty(t,"proxy",{enumerable:!0,get:function(){return r(S).default}}),Object.defineProperty(t,"persist",{enumerable:!0,get:function(){return r(T).default}})}));const P="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function h(e=16){let t="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*P.length);t+=P[e]}return t}importScripts("../amrnb.min.js","../silksdk.js");let A=self;A.print=e=>console.log("[OneUI-Audio]",e),A.printErr=e=>console.error("[OneUI-Audio]",e);const I={decodeAMR:function(e){A.print("Decoding AMR audio");const t=Date.now(),r=new self.AMR({}),n=r.decode(e);return r.close(),A.print(`Finished decoding AMR audio in ${Date.now()-t} ms`),n},decodeSilkV3:function(e){if(!A)throw new Error("SilkSDK is not ready.");const t=Date.now();A.print("Decoding SilkV3 audio");const r=h()+".bit",n=h()+".pcm";A.FS.writeFile(r,e),A.callMain([r,n]);const a=A.FS.readFile(n);A.FS.unlink(r),A.FS.unlink(n);const o=new Float32Array(a.length);for(let e=0;e<o.length;e++)o[e]=a[e]/32768;return A.print(`Finished decoding SilkV3 audio in ${Date.now()-t} ms`),o}};g.proxy(I),A.print("WebWorker is ready!"),A.print("OneUI-Audio is ready!")}();
//# sourceMappingURL=web-worker-0.js.map
